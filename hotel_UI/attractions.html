<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1">
    <meta name="viewport" content="width=device-width">
    <!-- <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content=""> -->


    <title>Nearby Attractions ðŸ—¼</title>

    <!-- Bootstrap libraries -->
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Latest compiled and minified CSS -->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css"
        integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">

    <!-- Latest compiled and minified JavaScript -->
    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.6/umd/popper.min.js"
        integrity="sha384-wHAiFfRlMFy6i5SRaxvfOCifBUQy1xHdJ/yoi7FRNXMRBu5WHdZYu1hA6ZOblgut"
        crossorigin="anonymous"></script>

    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/js/bootstrap.min.js"
        integrity="sha384-B0UglyR+jN6CkvvICOB2joaf5I4l3gm9GU6Hc1og6Ls7i6U/mkkaduKaBhlAXv9k"
        crossorigin="anonymous"></script>

    <!--
Ramayana CSS Template
https://templatemo.com/tm-529-ramayana
-->

    <!-- Additional CSS Files -->
    <link rel="stylesheet" href="assets/css/fontawesome.css">
    <link rel="stylesheet" href="assets/css/templatemo-style.css">
    <link rel="stylesheet" href="assets/css/owl.css">

</head>
<!-- Bootstrap libraries -->
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">


<!-- Latest compiled and minified JavaScript -->
<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->

<body class="is-preload">

    <!-- Wrapper -->
    <div id="wrapper">

        <!-- Main -->
        <div id="main">
            <div class="inner">

                <!-- Header -->
                <header id="header">
                    <div class="logo">
                        <a href="index.html">Hotel</a>
                    </div>
                </header>

                <!-- Page Heading -->
                <div class="page-heading">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                <h1>Nearby Attractions ðŸ—¼</h1>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Dropdown  -->
                <section class="simple-post">
                    <div class="container-fluid">
                        <div class="row">
                            <div class="col-md-12">
                                <input class="d-none" name="lat" type="text" id="lat">
                                <input class="d-none" name="lon" type="text" id="lon">
                                <input class="d-none" name="radius" type="text" id="radius" value="1000">
                                <!-- Type <input name="type" type="text" id="type" value="cafe"> -->
                                <div class="col-md-12">
                                    <label for="type">
                                        <h4 style="text-align: center;">Choose a type of attraction:</h4>
                                    </label>
                                    <select name="type" style="margin-left: 2px; width:80%;">
                                        <option value='tourist_attraction' class='dropdown-item'>Tourist Attraction
                                        </option>
                                        <option value='shopping_mall' class='dropdown-item'>Shopping Mall</option>
                                        <option value='restaurant' class='dropdown-item'>Restaurant</option>
                                        <option value='cafe' class='dropdown-item'>Cafe</option>
                                        <option value='bar' class='dropdown-item'>Bar</option>
                                        <option value='convenience_store' class='dropdown-item'>Convenience Store
                                        </option>
                                    </select>


                                    <button type="button" class="d-none btn btn-primary" onclick="getLocation()">Current
                                        Location</button>
                                    <br>
                                    <br>
                                    <button type="button" class="button" onclick='search();'>Search ðŸ‘€ </button>
                                    <br>
                                    <br>
                                </div>
                                <div class="col-md-12">
                                    <div class="loader mx-auto" id="loader"
                                        style="width: 3rem; height: 3rem; display: none;"></div>
                                        <br>
                                    <div id="searchOutput">
                                    </div>
                                    <div id="display_next_page_button">
                                    </div>
                                </div>
                                <!-- Modal for Google Map -->
                                <div class="modal fade" id="exampleModal" tabindex="-1"
                                    aria-labelledby="exampleModalLabel" aria-hidden="true" style="z-index: 10002;">
                                    <div class="modal-dialog">
                                        <div class="modal-content">
                                            <div class="modal-header">
                                                <h5 class="modal-title" id="exampleModalLabel">Directions</h5>
                                                <button type="button" class="btn-close" data-bs-dismiss="modal"
                                                    aria-label="Close">X</button>
                                            </div>
                                            <div class="modal-body mx-auto" id="modal-body">
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </section>

            </div>
        </div>

        <!-- Sidebar -->
        <div id="sidebar">

            <div class="inner">

                

                <!-- Menu -->
                <nav id="menu">
                    <ul>
                        <li><a href="index.html">Home</a></li>
                        <li><a href="profile.html">Profile</a></li>
                        <li><a href="roomservice.html">Room Service</a></li>
                        <li><a href="facility.html">Facility Booking</a></li>
                        <li><a href="cart.html">Cart</a></li>
                        <li><a href="attractions.html">Nearby Attractions</a></li>
                    </ul>
                </nav>

                <!-- Featured Posts -->
                <div class="featured-posts">
                    <div class="heading">
                        <h2>Featured Posts</h2>
                    </div>
                    <div class="owl-carousel owl-theme">
                        <a href="#">
                            <div class="featured-item">
                                <img src="assets/images/featured_post_01.jpg" alt="featured one">
                                <p>Travel in comfort with Singapore Airlines~!</p>
                            </div>
                        </a>
                        <a href="#">
                            <div class="featured-item">
                                <img src="assets/images/featured_post_02.jpg" alt="featured two">
                                <p>Patiently waiting for your arrival...</p>
                            </div>
                        </a>
                        <a href="#">
                            <div class="featured-item">
                                <img src="assets/images/featured_post_03.jpg" alt="featured three">
                                <p>Where elegance meets comfort in the heart of the city</p>
                            </div>
                        </a>
                    </div>
                </div>

                <!-- Footer -->
                <footer id="footer">
                    <p class="copyright">Copyright &copy; 2021 The Dream Team
                        <!-- <br>Designed by <a rel="nofollow" href="https://www.facebook.com/templatemo">Template Mo</a></p> -->
                </footer>

            </div>
        </div>
    </div>

    <script>
        //Loader stuff 
        var loader = document.getElementById('loader');
        let API_KEY = 'AIzaSyAw3Q7eJyqIazB2ucevU3NhnVmsqs5Z3bQ';
        $(document).ready(function () {
            if (navigator.geolocation) {
                navigator.geolocation.getCurrentPosition(showPosition);
            }
        })

        var counter = 0;

        function showPosition(position) {
            $("#lat").val(position.coords.latitude);
            $("#lon").val(position.coords.longitude);
        }

        async function search(page_token) {
            $('html, body').animate({ scrollTop: 0 }, 'fast');

            let lat = $("#lat").val();
            let lon = $("#lon").val();
            let radius = $("#radius").val();
            let type = $("option:selected").val();

            // var serviceURL = `http://127.0.0.1:5015/nearest_attractions/radius=${radius}&type_of_attraction=${type}&lat=${lat}&lon=${lon}`;
            var serviceURL = `http://54.179.169.210:5015/nearest_attractions/radius=${radius}&type_of_attraction=${type}&lat=${lat}&lon=${lon}`;

            if (page_token != undefined) {

                // serviceURL = `http://127.0.0.1:5015/nearest_attractions/next_page/page_token=${page_token}`
                serviceURL = `http://54.179.169.210:5015/nearest_attractions/next_page/page_token=${page_token}`
            }

            try {
                loader.style.display = 'block';
                const response =
                    await fetch(
                        serviceURL, { method: 'GET' }
                    );
                const result = await response.json();
                if (result.code === 200) {
                    // success case
                    loader.style.display = 'none';
                    $("#searchOutput").empty()
                    for (let location of result.data.results){

                        if (location.price_level == undefined) {
                            location.price_level = '-'
                        }
                        if ("photos" in location) {
                            var photo = location.photos[0].photo_reference
                        }
                        else {
                            var photo = ""
                        }
                        if (location.business_status == "CLOSED_TEMPORARILY") {
                            var status = "Closed Now"
                        }
                        else {
                            if ("opening_hours" in location) {
                                if (location.opening_hours.open_now) {
                                    var status = "Open Now";
                                }
                                else {
                                    var status = "Closed Now"
                                }
                            } else {
                                var status = "Closed Now"
                            }
                        }

                        if (location.rating <= 1) {
                            var emoji = "&#128532"
                        }
                        else if (location.rating <= 2) {
                            var emoji = "&#128533"
                        }
                        else if (location.rating <= 3) {
                            var emoji = "&#128528"
                        }
                        else if (location.rating <= 4) {
                            var emoji = "&#128516"
                        }
                        else if (location.rating <= 5) {
                            var emoji = "&#128522"
                        }
                        else if (location.rating == undefined) {
                            location.rating = '-'
                            var emoji = "&#129300"
                        }
                        $("#searchOutput").append(
                            `
                          <div class="card mb-3">
                            <div class="row g-0">
                              <div class="col-md-4">
                                <img src="https://maps.googleapis.com/maps/api/place/photo?maxwidth=350&maxheight=350&photoreference=${photo}&key=${API_KEY}
                                " alt="...">
                              </div>
                              <div class="col-md-8">
                                <div class="card-body">
                                  <h5 class="card-title item_name"><b>${location.name}</b></h5>
                                  <h6 class="card-subtitle mb-2 text-muted">${status}</h6>
                                  <ul class="list-group list-group-flush">
                                    <li class="list-group-item">
                                        <b>Address:</b> 
                                        <br>${location.vicinity}</br>
                                    </li>    
                                    <li class="list-group-item">
                                        <b>Price Level:</b> 
                                        ${location.price_level} ðŸ’¸
                                    </li>                   
                                    <li class="list-group-item">
                                      <b>Rating:</b> 
                                      ${location.rating} ${emoji}
                                    </li>
                                  </ul>
                                  <br>
                                    <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#exampleModal" onclick="getDirections('${location.place_id}','${lat}/${lon}')">Directions</button>
                                </div>
                              </div>
                            </div>
                          </div>`
                        );

                    }
                    if ("next_page_token" in result.data) {
                        var next_page_token = result.data.next_page_token;
                        $("#display_next_page_button").html(
                            `<button type="button" class="btn btn-secondary" data-bs-dismiss="modal" id="nextPageButton" onclick="search('${next_page_token}')">Next Page</button>
`                               )
                    }
                    else {
                        $("#display_next_page_button").empty();
                    }



                } else if (result.code == 404) {
                    // No books
                    showError(result.message);
                    loader.style.display = 'none';

                    $("#searchOutput").html(`<div class="alert alert-danger" role="alert">
                                            Unable to retrieve places of attraction, please try again!
                                        </div>`);

                } else {
                    // unexpected outcome, throw the error
                    loader.style.display = 'none';

                    throw response.status;
                }
            } catch (error) {
                // Errors when calling the service; such as network error, 
                // service offline, etc
                loader.style.display = 'none';

                $("#searchOutput").html(`<div class="alert alert-danger" role="alert">
                                            Unable to retrieve places of attraction, please try again!
                                        </div>`);

            } // error

        }

        function getDirections(place_id, current_coor) {
            let API_KEY = 'AIzaSyAw3Q7eJyqIazB2ucevU3NhnVmsqs5Z3bQ';
            $("#modal-body").html(
                `<iframe width="300" height="300" frameborder="0" style="border:0;"
                      src="https://www.google.com/maps/embed/v1/directions?key=${API_KEY}&origin=${current_coor}&mode=transit&destination=place_id:${place_id}"
                      allowfullscreen>
              </iframe>`

            )

        }
    </script>

    <!-- Scripts -->
    <!-- Bootstrap core JavaScript -->
    <script src="vendor/jquery/jquery.min.js"></script>
    <script src="vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.0-beta3/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-JEW9xMcG8R+pH31jmWH6WWP0WintQrMb4s7ZOdauHnUtxwoG2vI5DkLtS3qm9Ekf"
        crossorigin="anonymous"></script>

    <script src="assets/js/browser.min.js"></script>
    <script src="assets/js/breakpoints.min.js"></script>
    <script src="assets/js/transition.js"></script>
    <script src="assets/js/owl-carousel.js"></script>
    <script src="assets/js/custom.js"></script>
</body>




</html>